version: "1.0"

rules:
  - name: block-force-push
    description: "Prevents destructive force push operations"
    matchers:
      tools: ["Bash"]
      command_match: "git push.*--force|git push.*-f"
    actions:
      block: true

  - name: block-hard-reset
    description: "Prevents destructive hard reset operations"
    matchers:
      tools: ["Bash"]
      command_match: "git reset --hard"
    actions:
      block: true

  - name: capture-permission-request
    description: "Logs full PermissionRequest events to debugging/permissions_request.md"
    enabled_when: 'event_type == "PermissionRequest"'
    mode: audit
    matchers: {}
    actions:
      inline_script: |
        #!/bin/bash
        INPUT=$(cat)
        mkdir -p debugging
        TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
        {
          echo "## Permission Request - $TIMESTAMP"
          echo ""
          echo '```json'
          echo "$INPUT" | python3 -m json.tool 2>/dev/null || echo "$INPUT"
          echo '```'
          echo ""
          echo "---"
          echo ""
        } >> debugging/permissions_request.md

settings:
  log_level: "debug"
  debug_logs: true
  fail_open: false
