# Phase 14 Plan 02: Import/Export with Validation

## Wave
Wave 1 (independent of Plan 01 — can run in parallel, but sequential execution is fine)

## Objective
Add config import (from disk with validation) and export (save-as preserving comments) functionality to the sidebar. Addresses SC-2 (import with validation) and SC-3 (export preserving comments).

## Why This Plan Exists
Users need to share configs between machines, back up configurations, and apply configs from external sources. Import must validate before applying to prevent broken configs. Export must preserve YAML comments since users document their rules inline.

## Tasks

### Task 1: Add import/export Tauri wrappers
**File(s):**
- `rulez_ui/src/lib/tauri.ts` (MODIFY)

**Action:**
1. Add `importConfigFile()` function:
   ```typescript
   export async function importConfigFile(): Promise<{ path: string; content: string } | null>
   ```
   - In Tauri mode: use `open()` from `@tauri-apps/plugin-dialog` with filter `[{ name: "YAML", extensions: ["yaml", "yml"] }]`
   - If user selects a file, read it with `readTextFile()` from `@tauri-apps/plugin-fs`
   - Return `{ path, content }` or null if cancelled
   - In browser mode: use `<input type="file" accept=".yaml,.yml">` via a temporary hidden input element, read with `FileReader`, return content

2. Add `exportConfigFile(content: string, defaultName?: string)` function:
   ```typescript
   export async function exportConfigFile(content: string, defaultName?: string): Promise<boolean>
   ```
   - In Tauri mode: use `save()` from `@tauri-apps/plugin-dialog` with filter and defaultPath, then `writeTextFile()` from `@tauri-apps/plugin-fs`
   - In browser mode: use Blob + anchor download (same pattern as LogExportMenu)
   - Return true if exported, false if cancelled

**Acceptance:**
- Both functions work in Tauri and browser modes
- `tsc --noEmit` passes

### Task 2: Create ImportConfigDialog component
**File(s):**
- `rulez_ui/src/components/config/ImportConfigDialog.tsx` (NEW)

**Action:**
1. Create a modal dialog component that:
   - Shows the imported file path
   - Previews the YAML content (read-only, in a `<pre>` or code block)
   - Runs validation (calls `validateConfig` if available, else basic YAML parse check)
   - Shows validation result: green "Valid" or red "Invalid" with error list
   - Has two buttons: "Apply to Global" and "Apply to Project" (or a dropdown to choose target)
   - "Cancel" button to dismiss
2. On apply:
   - Call `writeConfig(targetPath, content)` to write the imported content
   - Call `configStore.openFile(targetPath, content)` to open it in the editor
   - Close the dialog
3. Props: `{ content: string; sourcePath: string; onClose: () => void }`
4. The dialog should use Tailwind styling consistent with the existing `ConfirmDialog` pattern

**Acceptance:**
- Dialog shows imported content preview
- Validation runs and displays results
- User can choose target scope (global or project)
- Invalid configs show errors and prevent applying
- `tsc --noEmit` passes

### Task 3: Add import/export buttons to Sidebar
**File(s):**
- `rulez_ui/src/components/layout/Sidebar.tsx` (MODIFY)

**Action:**
1. Add an "Import" button at the bottom of the sidebar (or as an icon button in the sidebar header):
   - On click: call `importConfigFile()`, then show `ImportConfigDialog` with the content
   - Icon: upload/import arrow icon
   - Aria label: "Import config"

2. Add an "Export" button next to each config file in the sidebar:
   - On click: get the file content from `configStore` (if open) or read it fresh via `readConfig(path)`
   - Call `exportConfigFile(content, filename)` — uses the raw string to preserve comments
   - Show brief "Exported!" feedback
   - Icon: download/export arrow icon
   - Aria label: "Export config"

3. Manage `ImportConfigDialog` state with `useState<{ content: string; sourcePath: string } | null>(null)` in Sidebar

**Acceptance:**
- Import button opens file picker, shows validation dialog, applies on confirm
- Export button saves raw YAML (with comments) to chosen location
- Both work in browser and Tauri modes
- `tsc --noEmit` passes

## Verification
1. `cd rulez_ui && npx tsc --noEmit` — passes
2. `npx biome check src/lib/tauri.ts src/components/config/ src/components/layout/Sidebar.tsx` — no errors
3. `npm run build` — succeeds
4. Visual: In browser dev mode, verify import opens file picker, export triggers download
