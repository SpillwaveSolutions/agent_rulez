# Plan 15-01: CLI `--json` Flag + Full Event Type Support

## Objective
Add `--json` flag to the CLI `debug` subcommand so the Tauri backend can parse structured output, and expand `SimEventType` to support all 7 event types.

## Tasks

### Task 1: Add `--json` flag to clap args
**File:** `cch_cli/src/main.rs`
- Add `#[arg(long)] json: bool` to the `Debug` variant of `Commands` enum
- Pass `json` through to `cli::debug::run()`

### Task 2: Expand SimEventType to all 7 variants
**File:** `cch_cli/src/cli/debug.rs`
- Add `UserPromptSubmit`, `SessionEnd`, `PreCompact` to `SimEventType` enum
- Add mappings in `as_model_event_type()` and `from_str()`
- Update the error message to list all 7 valid types

### Task 3: Add JSON output mode to debug::run()
**File:** `cch_cli/src/cli/debug.rs`
- Accept `json: bool` parameter in `run()`
- When `json` is true:
  - Suppress all human-readable println! output
  - Collect rule evaluations during processing
  - Build a JSON object matching the Tauri `DebugResult` struct:
    ```json
    {
      "outcome": "Allow" | "Block" | "Inject",
      "reason": "...",
      "matchedRules": ["rule-name"],
      "evaluationTimeMs": 1.2,
      "evaluations": [
        { "ruleName": "...", "matched": true, "timeMs": 0.5, "details": "...", "pattern": "...", "input": "..." }
      ]
    }
    ```
  - Use `std::time::Instant` to measure per-rule and total evaluation time
  - Print the single JSON object to stdout and exit

### Task 4: Wire json flag in main.rs dispatch
**File:** `cch_cli/src/main.rs`
- Extract `json` from `Commands::Debug { ... json }` destructure
- Pass it to `cli::debug::run(event_type, tool, command, path, verbose, json)`

## Verification
- `cargo check` passes in `cch_cli`
- `cargo test` passes in `cch_cli`
- Manual: `rulez debug PreToolUse --tool Bash --command "echo test" --json` outputs valid JSON
- Manual: `rulez debug UserPromptSubmit --json` works (new event type)

## Files Changed
- `cch_cli/src/main.rs`
- `cch_cli/src/cli/debug.rs`
