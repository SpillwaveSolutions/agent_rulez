---
phase: 21-copilot-cli-support-and-copilot-hooks-support
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - extensions/copilot-rulez-vscode/package.json
  - extensions/copilot-rulez-vscode/tsconfig.json
  - extensions/copilot-rulez-vscode/src/extension.ts
  - extensions/copilot-rulez-vscode/README.md
  - extensions/copilot-rulez-vscode/.vscodeignore
  - docs/COPILOT_VSCODE_EXTENSION.md
autonomous: true

must_haves:
  truths:
    - "Users can invoke RuleZ policy checks via Copilot chat commands."
    - "Chat participant returns a policy decision even when LM API is unavailable."
    - "Extension docs explain install, configuration, and known limitations."
  artifacts:
    - path: "extensions/copilot-rulez-vscode/package.json"
      provides: "Chat participant contribution + commands"
      contains: "chatParticipants"
    - path: "extensions/copilot-rulez-vscode/src/extension.ts"
      provides: "Chat participant implementation"
    - path: "docs/COPILOT_VSCODE_EXTENSION.md"
      provides: "VS Code extension usage guide"
  key_links:
    - from: "extensions/copilot-rulez-vscode/src/extension.ts"
      to: "extensions/copilot-rulez-vscode/package.json"
      via: "participant id + commands"
      pattern: "rulez.participant"
    - from: "extensions/copilot-rulez-vscode/src/extension.ts"
      to: "rulez binary"
      via: "spawn/exec call"
      pattern: "binaryPath"
---

<objective>
Create a VS Code Copilot chat participant that routes policy checks through RuleZ.

Purpose: Enable RuleZ policy enforcement and explanations inside Copilot chat workflows.
Output: VS Code extension scaffold, chat participant handler, and docs.
</objective>

<execution_context>
@/Users/richardhightower/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/richardhightower/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/21-copilot-cli-support-and-copilot-hooks-support/21-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold RuleZ Copilot chat participant extension</name>
  <files>
    extensions/copilot-rulez-vscode/package.json
    extensions/copilot-rulez-vscode/tsconfig.json
    extensions/copilot-rulez-vscode/src/extension.ts
    extensions/copilot-rulez-vscode/.vscodeignore
  </files>
  <action>
    Create a VS Code extension that registers a chat participant for RuleZ policy checks.
    - package.json: contribute a chat participant id `rulez.participant` with commands `/validate` and `/explain`.
    - Add configuration settings for `rulez.binaryPath` and `rulez.useLmSummary`.
    - extension.ts: register participant using vscode.chat.createChatParticipant and handle commands.
    - For `/validate`, build a RuleZ Event (UserPromptSubmit) with prompt and workspace info, then call the RuleZ binary (default `rulez`, fallback to `cch` if not found) by piping JSON via stdin and reading JSON response.
    - If `rulez.useLmSummary` is enabled and `vscode.lm.selectChatModels` returns a model, use LM API to summarize the policy decision; otherwise, return the raw RuleZ decision and reason.
    - Ensure LM API calls are triggered only from user-initiated chat requests.
  </action>
  <verify>npm install && npm run compile</verify>
  <done>Extension activates and responds to `/validate` and `/explain` with RuleZ policy output.</done>
</task>

<task type="auto">
  <name>Task 2: Add extension documentation</name>
  <files>
    extensions/copilot-rulez-vscode/README.md
    docs/COPILOT_VSCODE_EXTENSION.md
  </files>
  <action>
    Document installation and usage for the VS Code extension.
    - README in the extension directory with quick start and configuration options.
    - docs/COPILOT_VSCODE_EXTENSION.md with setup steps, example chat commands, and limitations (no inline suggestion pre-accept hooks).
  </action>
  <verify>npm run compile</verify>
  <done>Docs explain how to install, configure, and use RuleZ in Copilot chat.</done>
</task>

</tasks>

<verification>
- `npm install && npm run compile` (run in `extensions/copilot-rulez-vscode`)
</verification>

<success_criteria>
- VS Code chat participant is registered and handles `/validate` and `/explain` requests.
- RuleZ decisions are returned even without LM API consent.
- Documentation covers installation, configuration, and limitations.
</success_criteria>

<output>
After completion, create `.planning/phases/21-copilot-cli-support-and-copilot-hooks-support/21-04-SUMMARY.md`
</output>
