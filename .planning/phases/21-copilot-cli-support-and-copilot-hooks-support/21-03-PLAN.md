---
phase: 21-copilot-cli-support-and-copilot-hooks-support
plan: 03
type: execute
wave: 3
depends_on:
  - 21-02
files_modified:
  - cch_cli/src/cli/copilot_install.rs
  - cch_cli/src/cli/copilot_doctor.rs
  - cch_cli/src/cli.rs
  - cch_cli/src/main.rs
  - cch_cli/tests/copilot_install.rs
  - cch_cli/tests/copilot_doctor.rs
  - docs/COPILOT_CLI_HOOKS.md
  - scripts/copilot/rulez-pretool.sh
  - scripts/copilot/rulez-pretool.ps1
autonomous: true

must_haves:
  truths:
    - "Users can install Copilot hooks into .github/hooks with `cch copilot install`."
    - "Users can diagnose hook installation issues with `cch copilot doctor`."
    - "Docs explain where hooks live and how to troubleshoot missing hooks."
  artifacts:
    - path: "cch_cli/src/cli/copilot_install.rs"
      provides: "Copilot hook installer (writes .github/hooks JSON)"
    - path: "cch_cli/src/cli/copilot_doctor.rs"
      provides: "Copilot hook diagnostics"
    - path: "docs/COPILOT_CLI_HOOKS.md"
      provides: "Copilot CLI hook install + troubleshooting guide"
    - path: "scripts/copilot/rulez-pretool.sh"
      provides: "Bash hook wrapper for cch copilot hook"
  key_links:
    - from: "cch_cli/src/cli/copilot_install.rs"
      to: "scripts/copilot/rulez-pretool.sh"
      via: "hooks JSON command entry"
      pattern: "rulez-pretool"
    - from: "cch_cli/src/main.rs"
      to: "cch_cli/src/cli/copilot_doctor.rs"
      via: "Copilot subcommand dispatch"
      pattern: "CopilotSubcommand::Doctor"
---

<objective>
Provide Copilot hook installation, diagnostics, and documentation for CLI users.

Purpose: Make Copilot hooks easy to install and troubleshoot in real projects.
Output: Install/doctor subcommands, hook scripts, and Copilot CLI docs.
</objective>

<execution_context>
@/Users/richardhightower/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/richardhightower/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/21-copilot-cli-support-and-copilot-hooks-support/21-RESEARCH.md
@.planning/phases/20-gemini-cli-support-and-gemini-hooks-support/20-02-SUMMARY.md
@docs/GEMINI_CLI_HOOKS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Copilot hook install command + scripts</name>
  <files>
    cch_cli/src/cli/copilot_install.rs
    cch_cli/src/cli.rs
    cch_cli/src/main.rs
    scripts/copilot/rulez-pretool.sh
    scripts/copilot/rulez-pretool.ps1
  </files>
  <action>
    Implement `cch copilot install` to create a project-scoped hook file under `.github/hooks/`.
    - Write `.github/hooks/rulez.json` with `version: 1` and hooks for preToolUse and postToolUse.
    - Each hook entry should invoke the scripts in `scripts/copilot/` and pass stdin to `cch copilot hook`.
    - Provide a `--print` flag that outputs the JSON without writing to disk.
    - Create cross-platform scripts:
      scripts/copilot/rulez-pretool.sh (bash) and scripts/copilot/rulez-pretool.ps1 (PowerShell)
      that forward stdin to `cch copilot hook` and emit JSON to stdout only.
    - Wire the install subcommand into the Copilot CLI group.
  </action>
  <verify>cargo test -p cch copilot_install</verify>
  <done>Running `cch copilot install` creates `.github/hooks/rulez.json` pointing at the hook scripts.</done>
</task>

<task type="auto">
  <name>Task 2: Add Copilot hook diagnostics + docs</name>
  <files>
    cch_cli/src/cli/copilot_doctor.rs
    cch_cli/src/cli.rs
    cch_cli/src/main.rs
    cch_cli/tests/copilot_doctor.rs
    cch_cli/tests/copilot_install.rs
    docs/COPILOT_CLI_HOOKS.md
  </files>
  <action>
    Implement `cch copilot doctor` to scan `.github/hooks/*.json` and report status per hook file.
    - Report OK when a hook file contains a preToolUse entry invoking `cch copilot hook` (directly or via scripts).
    - Report WARN when hooks exist but none reference RuleZ.
    - Report MISSING when `.github/hooks` or hook files are absent.
    - Report ERROR when JSON is invalid or unreadable.
    - Provide `--json` output for machine parsing.
    - Wire `CopilotSubcommand::Doctor` in `cch_cli/src/main.rs` and export the module in `cch_cli/src/cli.rs`.
    - Add tests covering OK/WARN/MISSING/ERROR scenarios.
    - Write docs/COPILOT_CLI_HOOKS.md with install steps, doctor usage, and troubleshooting tips.
  </action>
  <verify>cargo test -p cch copilot_install copilot_doctor</verify>
  <done>Doctor command reports per-scope status and docs explain hook locations and fixes.</done>
</task>

</tasks>

<verification>
- `cargo test -p cch copilot_install copilot_doctor`
</verification>

<success_criteria>
- Copilot hook installer writes a valid `.github/hooks` JSON file and hook scripts.
- Copilot doctor reports status for missing, misconfigured, or valid hooks.
- Documentation covers install, diagnostics, and troubleshooting.
</success_criteria>

<output>
After completion, create `.planning/phases/21-copilot-cli-support-and-copilot-hooks-support/21-03-SUMMARY.md`
</output>
