---
phase: 20-gemini-cli-support-and-gemini-hooks-support
plan: 04
type: execute
wave: 3
depends_on:
  - "20-03"
files_modified:
  - cch_cli/src/cli/gemini_install.rs
  - cch_cli/src/cli/gemini_doctor.rs
  - cch_cli/src/cli.rs
  - cch_cli/src/main.rs
  - cch_cli/tests/gemini_install.rs
  - docs/GEMINI_CLI_HOOKS.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Users can generate or install Gemini hook settings that reference the cch Gemini hook runner command."
    - "Diagnostics and docs warn when hook commands reference an outdated cch binary without Gemini subcommands and provide remediation steps."
  artifacts:
    - path: "cch_cli/src/cli/gemini_install.rs"
      provides: "Gemini hook settings generator/installer"
    - path: "cch_cli/src/cli/gemini_doctor.rs"
      provides: "Diagnostics that flag missing or outdated Gemini hook commands"
    - path: "docs/GEMINI_CLI_HOOKS.md"
      provides: "Install guidance and outdated-binary remediation"
  key_links:
    - from: "cch_cli/src/cli/gemini_install.rs"
      to: ".gemini/settings.json"
      via: "settings.json writer/merge"
      pattern: "settings.json"
    - from: "cch_cli/src/cli/gemini_doctor.rs"
      to: "docs/GEMINI_CLI_HOOKS.md"
      via: "doctor warnings reference docs guidance"
      pattern: "gemini"
---

<objective>
Add Gemini hook install/generation support and improve diagnostics/documentation so users can recover from missing hooks or outdated binaries that lack Gemini subcommands.

Purpose: Close setup friction by providing a deterministic install path and clear remediation when the binary on PATH is stale.
Output: Gemini install command, enhanced diagnostics, and updated docs.
</objective>

<execution_context>
@/Users/richardhightower/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/richardhightower/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@cch_cli/src/cli/install.rs
@cch_cli/src/cli/gemini_doctor.rs
@docs/GEMINI_CLI_HOOKS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Gemini install/generate command with tests</name>
  <files>cch_cli/src/cli/gemini_install.rs, cch_cli/src/cli.rs, cch_cli/src/main.rs, cch_cli/tests/gemini_install.rs</files>
  <action>
Add a `cch gemini install` subcommand that writes or merges Gemini hook entries into the selected scope (`.gemini/settings.json` project/user/system). The command should generate hooks that call the new `cch gemini hook` runner (using the detected binary path or `--binary` override) and preserve existing non-cch hook entries. Include a `--print` or `--dry-run` option that outputs the JSON snippet without writing, and tests that validate merge behavior and generated command strings.
  </action>
  <verify>cargo test -p cch gemini_install</verify>
  <done>Running `cch gemini install` produces a settings.json entry that references `cch gemini hook` and preserves existing hooks.</done>
</task>

<task type="auto">
  <name>Task 2: Update diagnostics and docs for outdated binary remediation</name>
  <files>cch_cli/src/cli/gemini_doctor.rs, docs/GEMINI_CLI_HOOKS.md</files>
  <action>
Enhance `cch gemini doctor` to flag hook commands that reference `cch` without the `gemini hook` subcommand, and include a warning detail indicating the binary may be outdated. Update docs to include install guidance (using `cch gemini install` plus a sample settings.json snippet), and add a troubleshooting section that instructs users to verify `cch --help` includes the Gemini subcommands, update their PATH, or reinstall/symlink the latest binary.
  </action>
  <verify>cargo test -p cch gemini_doctor</verify>
  <done>Doctor reports missing/outdated hook commands with remediation guidance, and docs show install + upgrade steps.</done>
</task>

</tasks>

<verification>
- `cargo test -p cch gemini_install` passes
- `cargo test -p cch gemini_doctor` passes
</verification>

<success_criteria>
- Users can generate or install Gemini hook settings that point to `cch gemini hook`.
- Diagnostics and docs make outdated binaries and PATH issues obvious with clear fixes.
</success_criteria>

<output>
After completion, create `.planning/phases/20-gemini-cli-support-and-gemini-hooks-support/20-04-SUMMARY.md`
</output>
